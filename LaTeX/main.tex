\documentclass[12pt]{exam}

\usepackage{setspace}
\usepackage{listings}
\usepackage{graphicx,subfigure,wrapfig}
\usepackage{multirow}
\usepackage[colorlinks=true,urlcolor=blue]{hyperref}
\usepackage[margin=20mm]{geometry}
\usepackage{xepersian}
\usepackage{fontspec}
\settextfont[ExternalLocation]{XB Niloofar.ttf}
   
\newcommand{\class}{طراحی پایگاه داده‌ها}
\newcommand{\term}{نیم‌سال دوم 02-03}
\newcommand{\college}{دانشکده مهندسی کامپیوتر}
\newcommand{\prof}{استاد: مهدی آخی }

\singlespacing 
\parindent 0ex

\lstset{
keywordstyle=\textbf,
identifierstyle=, 
stringstyle=\ttfamily,
commentstyle=\color{LimeGreen}, 
stringstyle=\ttfamily,
numberstyle=\footnotesize,
showstringspaces=false} 
\begin{document}

\include{info}
\pagestyle{empty}
\include{cover-page}

% These commands set up the running header on the top of the exam pages
\pagestyle{head}
\firstpageheader{}{}{}
\runningheader{صفحه \thepage\ از \numpages}{ملیکا علیزاده - ثمین اکبری - معین آعلی}{\class}
\runningheadrule

\pagebreak

\subsection*{\underline{تقسیم‌بندی پروژه}}
\subsubsection*{تسک‌های مربوط به عضو اول: \href{https://github.com/MelikaAlizadeh}{ملیکا علیزاده}}
\begin{enumerate}
	
	
	\item شناسایی موجودیت ها (Entities) از پروژه
	
	\item شناسایی صفات (Attributes) از پروژه
	
	\item طراحی موجودیت ها و صفات در Draw.io
	
	\item طراحی روابط در Draw.io
	
	\item نوشتن توضیحات برای ERD
	
\end{enumerate}
\subsubsection*{تسک‌های مربوط به عضو دوم: \href{https://github.com/saminakbari}{ثمین اکبری} }
\begin{enumerate}
	
	\item شناسایی موجودیت ها (Entities) از پروژه
	
	\item شناسایی صفات (Attributes) از پروژه
	
	\item طراحی موجودیت ها و صفات در Draw.io
	
	\item طراحی روابط در Draw.io
	
	\item نوشتن جبر رابطه‌ای
	
	
\end{enumerate}
\subsubsection*{تسک‌های مربوط به عضو سوم: \href{https://github.com/MoeeinAali}{معین آعلی}}
\begin{enumerate}
	
	\item ایجاد مخزن گیت هاب و تعریف مساله
	
	\item طراحی موجودیت ها و صفات در Draw.io
	
	\item آماده سازی لاتک (LaTeX) برای پاسخ های پروژه
	
	\item نوشتن جبر رابطه‌ای
	
	\item نوشتن جبر رابطه‌ای با LaTeX
	
	
\end{enumerate}

جزئیات تقسیم‌بندی کارها داخل این 
\href{https://github.com/MoeeinAali/DB-Project/issues/1}{Issue Github}
موجود است.

\pagebreak
\subsection*{\underline{نمودار رابطه-موجودیت}}

$\includegraphics[width=1\linewidth]{figs/1.png}$

فایل Draw.io مربوط به ERD پروژه، داخل پیوست قرار دارد. 

در این بخش توضیحات مربوط به روابط مختلف این ERD آورده شده است:

\begin{enumerate}
	\item هسته محصول:
	\begin{itemize}
		\item 
برای کاربر (user) یک entity در نظر گرفته‌ایم که ویژگی‎های داده‎شده attribut های آن هستند. از آنجا که هر یک از انواع کاربر، روابط و صفات متفاوتی دارند، هر یک را با استفاده از specialization یک entity جدا گرفتیم که از user ارث‌بری می‌کنند.
		\item 
کیف پول (wallet) را یک موجودیت ضعیف در نظر گرفتیم چون بدون وجود user این موجودیت بی‎معنی است. همچنین نمی‎توان آن را با user یکی کرد چون معناها و صفات متفاوتی دارند.
		\item 
با توجه به اینکه هر تراکنش بانکی (Bank-Transaction) شامل ویژگی‌ها و اطلاعات مختلفی است، آن را به عنوان یک entity در نظر گرفتیم که با یک حساب بانکی در ارتباط است.

		\item 
		در هر تراکنش بانکی که یک کاربر با حساب بانکی و کیف پول خودش انجام میدهد، یا مبلغی (amount) از حساب بانکی شخص به کیف پولش پرداخت می‎شود یا مبلغی در هنگام رزرو از کیف پول شخص برداشته شده و به حسابش واریز میشود.
		پس فقط یک حساب بانکی (bank-account) باید در هر تراکنش شرکت کند ولی هر حساب بانکی میتواند در چند تراکنش شرکت کند.
		
		نوع دیگری از تراکنش هم این است که هنگام رزرو، مبلغی از کیف پول مشتری به کیف پول ارائه‎دهنده خدمات پرداخت میشود یا در مواردی مقداری از هزینه به واسطه کد تخفیف مارکتینگ از کیف پول ادمین مارکتینگ به کیف پول هتل یا شرکت واریز میشود.
		\item 
		نوع (type) تراکنش نشان میدهد که پول از حساب برداشت شده یا به حساب واریز شده است. \linebreak وضعیت (state) هم سه حالت پرداخت، پرداخت شده و ناموفق دارد.
		\item 
برای transaction-history یک entity جدا قرار دادیم که به عنوان partial-key شناسه کاربر و تراکنش‎هایش را دارد. اگر تراکنش از نوع wallet-wallet بود، مشخصات رزرو و در نتیجه سفر مورد نظر قابل دسترسی است. اگر هم wallet-bank-account باشد، میزان پول واریزی یا برداشتی را می‌توان به کاربر نشان داد.
		\item 
کد تخفیف (discount-code) هم یک entity با چند صفت است که خودش دو نوع ثابت و درصدی دارد. همچنین هر کد تخفیف را یک user میدهد و user دیگری دریافت میکند. بنابراین هر کد تخفیف با دو user در ارتباط است و هر user ممکن است چند کد تخفیف تعریف کند یا دریافت کند. پس رابطه m:n داریم.
همچنین هر کد تخفیف ممکن است در چند reserve استفاده شود و هر reserve می‌تواند چند کد تخفیف داشته باشد.
کد تخفیف یک بیشینه تعداد دفعات استفاده دارد و یک تعداد دفعات استفاده. هرگاه این دو مقدار برابر شوند، state آن به "used" تغییر کرده و کاربر دیگر نمی‌تواند از آن استفاده کند.
		
	\end{itemize}
\end{enumerate}
\pagebreak

\subsection*{\underline{جبر رابطه‌ای}}

در این بخش پاسخ پرسمان‌های زیر با استفاده از جبر رابطه‌ای آورده شده است:

\begin{enumerate}
	\item
‌هواپیماهایی که در ۲۹ اسفند از تهران به مشهد می‌روند و بیشتر از ۵ صندلی خالی دارند را پیدا کنید.

با ‌فرض این‌ که منظور از صورت سوال نام هواپیماها است و فرض می‌کنیم نام هواپیماها یکتا هستند، \linebreak جبر رابطه‌ای زیر را می‌نویسیم:

\setLTR
$
selectedAirplane =  \pi_{airplaneName}(\sigma_{COUNT(*)>5}(\gamma_{reserveID}(\\ \sigma_{startDate = 1403.12.29 \ \land \ airTerminalOrig = Tehran \ \land \ airTerminalDest = Mashhad}(\\ AirTerminal \bowtie_{terminalID} airTrip \bowtie_{tripNumber} transportReservation \bowtie_{accountID} cutomer)))) \\
$
\setRTL
\rule{\linewidth}{0.05mm}

	\item
هتل‌هایی که در تاریخ ۱ فروردین اتاق دو تخته‌ی خالی دارند و امکانات استخر و باشگاه و \linebreak امتیاز بالای ۴ دارند را پیدا کنید.

\setLTR
$moeein\\$
\setRTL
\rule{\linewidth}{0.05mm}


	\item
	 میزان تخفیفی که مشتریان با استفاده از کد تخفیف  norouz  دریافت کرده‌اند را حساب کنید.
	 
\setLTR
$moeein\\$
\setRTL
\rule{\linewidth}{0.05mm}
	 
	 
	\item
	 تماس‌های پشتیبانی که در مورد هتل الماس بوده‌اند را پیداکنید.

\setLTR
$moeein\\$
\setRTL
\rule{\linewidth}{0.05mm}	 
	 
	 
	 
	 
	\item
مجموع هزینه‌هایی که‌ به واسطه باشگاه مشتریان در ماه فروردین کسر شده‌است را بیابید.

\setLTR
$moeein\\$
\setRTL
\rule{\linewidth}{0.05mm}


	\item
تعداد رزروهایی که در مدت معین پرداخت نشده، و لغو شده‌اند را بیابید.

\setLTR
$moeein\\$
\setRTL
\rule{\linewidth}{0.05mm}




	\item
تعداد مسافرین به تفکیک نوع سفر(قطار، اتوبوس، هواپیما) در تعطیلات نوروز(اول تا 13 فروردین ماه) را بیابید.

\setLTR
$moeein\\$
\setRTL
\rule{\linewidth}{0.05mm}



	
	\item
	 آمار تعداد کنسلی رزروهای هتل‌ها در 5 شهر با بیشترین خرید بلیط به مقصد آنجا به‌ تفکیک ستاره هتل‌ها را بیابید.
	  
\setLTR
$moeein\\$
\setRTL
\rule{\linewidth}{0.05mm}	 
	 
	 
	
	\item
	 همه مسافرانی که در پرواز $W1296$ در تاریخ 6 فروردین برای همان روز در هتلی با بیشترین اتاق خالی رزرو دارند.
	
\setLTR
$moeein\\$
\setRTL
\rule{\linewidth}{0.05mm}
	
	
	
	\item
	 مشتریانی را بیابید که برای تاریخ ۱ فروردین، بلیط به مقصد شهر بابلسر رزرو کرده‌اند و همچنین \linebreak با کد تخفیف ۳۰ هزار تومانی (که در بخش CRM به‌ آن اشاره شد) رزرو هتل خود را هم از سایت انجام داده‌اند.
	 
\setLTR
$moeein\\$
\setRTL
\rule{\linewidth}{0.05mm}	 
	 
	 
	
\end{enumerate}

\end{document}