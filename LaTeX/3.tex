\subsection*{\underline{توضیحات نمودار}}

در این بخش توضیحات مربوط به روابط مختلف ERD پروژه آورده شده است:

\begin{enumerate}
	\item هسته محصول:
	\begin{itemize}
		\item 
		برای کاربر (user) یک entity در نظر گرفته‌ایم که ویژگی‎های داده‎شده attribut های آن هستند. از آنجا که هر یک از انواع کاربر، روابط و صفات متفاوتی دارند، هر یک را با استفاده از specialization یک entity جدا گرفتیم که از user ارث‌بری می‌کنند.
		\item 
		کیف پول (wallet) را یک موجودیت ضعیف در نظر گرفتیم چون بدون وجود user این موجودیت بی‎معنی است. همچنین نمی‎توان آن را با user یکی کرد چون معناها و صفات متفاوتی دارند.
		\item 
		با توجه به اینکه هر تراکنش بانکی (Bank-Transaction) شامل ویژگی‌ها و اطلاعات مختلفی است، آن را به عنوان یک entity در نظر گرفتیم که با یک حساب بانکی در ارتباط است.
		
		\item 
		در هر تراکنش بانکی که یک کاربر با حساب بانکی و کیف پول خودش انجام میدهد، یا مبلغی (amount) از حساب بانکی شخص به کیف پولش پرداخت می‎شود یا مبلغی در هنگام رزرو از کیف پول شخص برداشته شده و به حسابش واریز میشود.
		پس فقط یک حساب بانکی (bank-account) باید در هر تراکنش شرکت کند ولی هر حساب بانکی میتواند در چند تراکنش شرکت کند.
		
		نوع دیگری از تراکنش هم این است که هنگام رزرو، مبلغی از کیف پول مشتری به کیف پول ارائه‎دهنده خدمات پرداخت میشود یا در مواردی مقداری از هزینه به واسطه کد تخفیف مارکتینگ از کیف پول ادمین مارکتینگ به کیف پول هتل یا شرکت واریز میشود.
		\item 
		نوع (type) تراکنش نشان میدهد که پول از حساب برداشت شده یا به حساب واریز شده است. \linebreak وضعیت (state) هم سه حالت پرداخت، پرداخت شده و ناموفق دارد.
		\item 
		برای transaction-history یک entity جدا قرار دادیم که به عنوان partial-key شناسه کاربر و تراکنش‎هایش را دارد. اگر تراکنش از نوع wallet-wallet بود، مشخصات رزرو و در نتیجه سفر مورد نظر قابل دسترسی است. اگر هم wallet-bank-account باشد، میزان پول واریزی یا برداشتی را می‌توان به کاربر نشان داد.
		\item 
		کد تخفیف (discount-code) هم یک entity با چند صفت است که خودش دو نوع ثابت و درصدی دارد. همچنین هر کد تخفیف را یک user میدهد و user دیگری دریافت میکند. بنابراین هر کد تخفیف با دو user در ارتباط است و هر user ممکن است چند کد تخفیف تعریف کند یا دریافت کند. پس رابطه m:n داریم.
		همچنین هر کد تخفیف ممکن است در چند reserve استفاده شود و هر reserve می‌تواند چند کد تخفیف داشته باشد.
		کد تخفیف یک بیشینه تعداد دفعات استفاده دارد و یک تعداد دفعات استفاده. هرگاه این دو مقدار برابر شوند، state آن به "used" تغییر کرده و کاربر دیگر نمی‌تواند از آن استفاده کند.
		
	\end{itemize}
	\item رزرو هتل:
	\begin{itemize}
		\item 
		هتل و رزرو آن هم بسیار مشابه رزرو بلیط است. چند ستاره بودن هتل در type آن مشخص شده است. هر هتل چند اتاق دارد. هر اتاق شناسه و ویژگی‌های خاص خودش را دارد. هر گاه اتاقی رزرو شود، state آن به reserved تغییر می‌کند. ادمین هتل می‌تواند قیمت هر اتاق را تغییر دهد. زمان شروع و پایان هر رزرو مشخص است. برای اطلاع از خالی بودن اتاق در یک تاریخ خاص می‌توان از اطلاعات ذخیره شده در بخش hotel-reservation استفاده کرد. state هم در این موجودیت با تغییر وضعیت پرداخت یا تایید رزرو تغییر می‌کند.
		وضعیت (state) در رزرو هتل و بلیط متفاوت در نظر گرفته شده‌ است. چون وضعیت‎ها متفاوت است (در رزرو بلیط نیازی به تایید ادمین نیست).
		نظرسنجی و امتیازدهی و همچنین کنسل شدن و قوانین آن مشابه بخش قبل است.
		\item 
		نظرسنجی یک موجودیت در نظر گرفته شده که شامل customer-id، امتیاز و کامنت است. بسته به نوع نظرسنجی، hotel-id یا trip-id هم برای نظرسنجی ثبت می‌شود.
	\end{itemize}
	\pagebreak
	\item باشگاه مشتریان:
	\begin{itemize}
		\item 
		باشگاه مشتریان نام موجودیتی است که در آن می‌توان آیدی یک مشتری را به همراه سطح‎بندی آنها ذخیره کرد. سطح هر مشتری با توجه به مبلغ خرج شده که در موجودیت customer داریم مشخص می‌شود. همچنین خود این مبالغ هم با استفاده از تراکنش‎های بانکی کاربر مشخص می‌شود.
		قابلیت‎هایی که هر سطح ایجاد می‌کند باید در پیاده‎سازی انجام شوند و نیازی به نشان دادن آن‌ها در ER نیست.
	\end{itemize}
	\item خرید بلیط:
	\begin{itemize}
		\item 
موضوع خرید بلیط و رزرو هتل در ER ما با موجودیت reservation هندل شده‎اند. در نوع "رزرو سفر" یا همان بلیط، یک سفر (trip) رزرو می‌شود. هزینه رزرو همان هزینه سفر است. در صورت وارد شدن کد تخفیف و با توجه به جایگاه مشتری در باشگاه مشتریان مبلغ پرداختی مشتری کاهش می‎یابد. همچنین ادمین می‌تواند این هزینه را در ساعات پایانی تغییر دهد. زمان شروع و پایان سفر و قوانین کنسلی از طریق ارتباط با trip و وجود foreign-key مرتبط با trip-number در trip-reservation قابل دسترسی است. قانون کنسلی به صورت یک تابع خاص برای هر شرکت در سامانه ذخیره می‌شود. همچنین هر رزرو، یک تاریخ و یک حالت (state) دارد که نشان می‌دهد رزرو نهایی شده است یا نه. رزرو 10 دقیقه در حالت تعلیق باقی می‌ماند و اگر نهایی نشود کنسل شده و از سامانه حذف می‌شود.
		\item 
ترمینال‎ها سه نوع هستند. هر train-terminal می‌تواند قطارهای اتوبوسی، کوپه‌ای یا هر دو را داشته باشند.
		\item 
هر سفر (trip) دو کلید خارجی دارد که به terminal-id اشاره می‌کنند؛ یکی برای ترمینال مبدا و یکی برای ترمینال مقصد. همچنین هر ترمینال چند سفر را انجام می‌دهد بنابراین رابطه m:n بین آن‌ها برقرار است. هر سفر خودش سه نوع دارد که هر یک ویژگی‎های مختص خود را دارند.
		\item 
هر سفر چند صندلی (seat) دارد. در ابتدا همه صندلی‎ها قابل رزرو هستند. به محض اینکه یک کاربر رزرو یک صندلی را نهایی می‌کند، وضعیت آن به reserved تغییر می‌کند و مسافر دیگری نمی‌تواند آن را رزرو کند. اگر هم رزرو کنسل شد، دوباره وضعیت به empty تغییر می‌کند. به این ترتیب شماره صندلی مسافر در هر reserve مشخص می‌شود.
		\item 
هر شرکت (company) هم به همراه ویژگی‎ها و امتیازش در سامانه ذخیره می‌شود. score می‌تواند از میانگین یا مجموع امتیازاتی که مسافران در نظرسنجی‎ها می‌دهند محاسبه شود. پس صفت مشتق است.
		\item 
یک موجودیت هم برای نظرسنجی (survey) داریم که در آن هر مسافر می‌تواند امتیاز و نظرش را ثبت کند.
	\end{itemize}

	\item بخش پشتیبانی و مدیریت ارتباط با مشتریان:
	\begin{itemize}
		\item 
یک موجودیت ticket داریم که نوع و پیام آن به همراه آیدی فرستنده و آیدی عضو پشتیبانی که ticket به او ارسال می‌شود در آن ذخیره می‌شود. همچنین یک اولویت (priority) داریم که با توجه به نوع پیام تعیین می‌شود.
		\item 
موجودیت پیامک (SMS) هم یک فرستنده دارد که ادمین پشتیبانی است و یک دریافت‎کننده که مشتری است. نوع (یادآور یا ترغیب‎کننده) و متن و زمان آن هم مشخص می‌شود.
	\end{itemize}
\end{enumerate}